<idea-plugin package="cn.osc.gitee.github">
  <name>GitHub</name>
  <id>cn.osc.gitee.github</id>
  <vendor>JetBrains</vendor>
  <category>Version Controls</category>
  <description>
    <![CDATA[
      Provides integration with <a href="http://github.com/">GitHub</a>.
        <ul>
        <li>Specify your GitHub account to access all of your repositories from the IDE.</li>
        <li>Clone repositories, create and review pull requests, create gists, and much more.</li>
        </ul>
        <p>To configure, open <b>Settings / Preferences</b> and go to Version Control | GitHub.</p>
        <p>Requires the Git plugin.</p>
      ]]>
  </description>

  <resource-bundle>messages.GithubBundle</resource-bundle>

  <dependencies>
    <plugin id="com.intellij.modules.lang"/>
    <plugin id="Git4Idea"/>
  </dependencies>

  <extensions defaultExtensionNs="com.intellij">
    <httpRequestHandler implementation="cn.osc.gitee.github.authentication.GHOAuthCallbackHandler"/>

    <applicationService serviceImplementation="cn.osc.gitee.github.util.GithubSettings"/>

    <applicationService serviceImplementation="cn.osc.gitee.github.authentication.accounts.GHPersistentAccounts"/>
    <applicationService serviceImplementation="cn.osc.gitee.github.authentication.GithubAuthenticationManager"/>
    <applicationService serviceImplementation="cn.osc.gitee.github.api.GithubApiRequestExecutor$Factory"/>
    <applicationService serviceImplementation="cn.osc.gitee.github.api.GithubApiRequestExecutorManager"/>
    <applicationService serviceImplementation="cn.osc.gitee.github.authentication.accounts.GithubAccountInformationProvider"/>
    <applicationService serviceImplementation="cn.osc.gitee.github.util.CachingGHUserAvatarLoader"/>

    <projectService serviceImplementation="cn.osc.gitee.github.extensions.GHGitAuthenticationFailureManager"/>
    <projectService serviceImplementation="cn.osc.gitee.github.util.GithubProjectSettings"/>
    <projectService serviceImplementation="cn.osc.gitee.github.util.GithubSharedProjectSettings"/>
    <projectService serviceImplementation="cn.osc.gitee.github.authentication.accounts.GithubProjectDefaultAccountHolder"/>

    <vcsAnnotationGutterActionProvider implementation="cn.osc.gitee.github.extensions.GHAnnotationGutterActionProvider"/>
    <projectConfigurable parentId="project.propVCSSupport.Mappings" groupWeight="-500"
                         instance="cn.osc.gitee.github.ui.GithubSettingsConfigurable"/>
    <statistics.applicationUsagesCollector
      implementation="cn.osc.gitee.github.authentication.accounts.GithubAccountsStatisticsCollector"/>
    <statistics.counterUsagesCollector
      implementationClass="cn.osc.gitee.github.pullrequest.GHPRStatisticsCollector$Counters"/>
    <statistics.notificationIdsHolder implementation="cn.osc.gitee.github.util.GithubNotificationIdsHolder"/>
    <backgroundPostStartupActivity implementation="cn.osc.gitee.github.pullrequest.GHServerVersionsCollector$Initializer"/>

    <diff.DiffExtension implementation="cn.osc.gitee.github.pullrequest.ui.changes.GHPRViewedStateDiffExtension"/>
    <diff.DiffExtension implementation="cn.osc.gitee.github.pullrequest.comment.GHPRReviewThreadsDiffExtension"/>
    <openapi.vcs.ui.cloneDialog.VcsCloneDialogExtension
      implementation="cn.osc.gitee.github.ui.cloneDialog.GHCloneDialogExtension"/>
    <openapi.vcs.ui.cloneDialog.VcsCloneDialogExtension
      implementation="cn.osc.gitee.github.ui.cloneDialog.GHECloneDialogExtension"/>

    <virtualFileSystem key="ghpr" implementationClass="cn.osc.gitee.github.pullrequest.GHPRVirtualFileSystem"/>
    <fileIconProvider implementation="cn.osc.gitee.github.pullrequest.GHPRVirtualFileIconProvider" order="first"/>
    <fileEditorProvider implementation="cn.osc.gitee.github.pullrequest.GHPREditorProvider"/>

    <toolWindow id="Pull Requests" icon="cn.osc.gitee.github.GithubIcons.PullRequestsToolWindow"
                anchor="left" doNotActivateOnStart="true"
                factoryClass="cn.osc.gitee.github.pullrequest.GHPRToolWindowFactory"/>

    <diff.actions.ShowDiffAction.ExtensionProvider
      implementation="cn.osc.gitee.github.pullrequest.action.GHPRShowDiffActionProvider"/>
    <diff.actions.ShowStandaloneDiffAction.ExtensionProvider
      implementation="cn.osc.gitee.github.pullrequest.action.GHPRShowDiffActionProvider"/>

    <fileIconProvider implementation="cn.osc.gitee.github.extensions.GithubYamlIconProvider"/>

    <registryKey defaultValue="true" description="Applying suggested changes" key="github.suggested.changes.apply"/>
    <iconMapper mappingFile="GithubIconMappings.json"/>
  </extensions>

  <extensions defaultExtensionNs="Git4Idea">
    <GitHttpAuthDataProvider implementation="cn.osc.gitee.github.extensions.GHHttpAuthDataProvider"/>
    <GitHttpAuthDataProvider implementation="cn.osc.gitee.github.extensions.GHComHttpAuthDataProvider"/>
    <gitRepositoryHostingService implementation="cn.osc.gitee.github.extensions.GHRepositoryHostingService"/>
    <gitProtectedBranchProvider implementation="cn.osc.gitee.github.util.GithubProtectedBranchProvider"/>
    <gitFetchHandler implementation="cn.osc.gitee.github.extensions.GHProtectedBranchRulesLoader"/>
  </extensions>

  <actions>
    <action id="Github.Share" class="cn.osc.gitee.github.GithubShareAction">
      <add-to-group group-id="Vcs.Import"/>
      <add-to-group group-id="Vcs.ToolbarWidget.ShareProject" relative-to-action="Start.Use.Vcs" anchor="before"/>
      <override-text place="Vcs.Toolbar.Widget"/>
    </action>
    <action id="Github.Sync.Fork" class="cn.osc.gitee.github.GithubSyncForkAction">
      <add-to-group group-id="Git.Menu"/>
    </action>
    <action id="Github.Create.Pull.Request" class="cn.osc.gitee.github.pullrequest.action.GHPRCreatePullRequestAction">
      <add-to-group group-id="Git.Menu"/>
    </action>
    <action id="Github.View.Pull.Request" class="cn.osc.gitee.github.GithubViewPullRequestsAction">
      <add-to-group group-id="Git.Menu"/>
    </action>
    <action id="Github.Open.In.Browser" class="cn.osc.gitee.github.GHOpenInBrowserActionGroup">
      <override-text place="EditorTabPopup"/>
      <override-text place="ProjectViewPopup" use-text-of-place="EditorTabPopup"/>
      <override-text place="EditorPopup" use-text-of-place="EditorTabPopup"/>
      <override-text place="FavoritesPopup" use-text-of-place="EditorTabPopup"/>
      <add-to-group group-id="RevealGroup"/>
      <add-to-group group-id="Vcs.Log.ContextMenu" anchor="last"/>
      <add-to-group group-id="VcsHistoryActionsGroup" anchor="last"/>
      <add-to-group group-id="VcsHistoryActionsGroup.Toolbar"/>
      <add-to-group group-id="VcsSelectionHistoryDialog.Popup" anchor="last"/>
    </action>
    <action id="Github.Create.Gist" class="cn.osc.gitee.github.GithubCreateGistAction">
      <add-to-group group-id="EditorPopupMenu"/>
      <add-to-group group-id="ProjectViewPopupMenu"/>
      <add-to-group group-id="EditorTabPopupMenu"/>
      <add-to-group group-id="ConsoleEditorPopupMenu"/>
    </action>
    <group id="GitHub.MainMenu" popup="true">
      <reference ref="Github.Share"/>
      <reference ref="Github.Create.Pull.Request"/>
      <reference ref="Github.View.Pull.Request"/>
      <reference ref="Github.Sync.Fork"/>
      <reference ref="Github.Create.Gist"/>
      <reference ref="Github.Open.In.Browser"/>

      <add-to-group group-id="Git.MainMenu" relative-to-action="Git.Configure.Remotes" anchor="before"/>
    </group>
    <group id="Github.PullRequest.ToolWindow.List.Popup">
      <action id="Github.PullRequest.Show"
              class="cn.osc.gitee.github.pullrequest.action.GHPROpenPullRequestAction"/>
      <reference id="Github.Open.In.Browser"/>
      <action id="Github.PullRequest.List.Reload"
              class="cn.osc.gitee.github.pullrequest.action.GHPRReloadListAction" use-shortcut-of="Refresh"/>
    </group>
    <group id="Github.PullRequest.Details.Popup">
      <action id="Github.PullRequest.Timeline.Show"
              class="cn.osc.gitee.github.pullrequest.action.GHPROpenPullRequestTimelineAction"/>
      <reference id="Github.Open.In.Browser"/>
      <action id="Github.PullRequest.Branch.Create"
              class="cn.osc.gitee.github.pullrequest.action.GHPRCreateBranchAction"/>
      <action id="Github.PullRequest.Branch.Update"
              class="cn.osc.gitee.github.pullrequest.action.GHPRUpdateBranchAction"/>
      <action id="Github.PullRequest.Details.Reload"
              class="cn.osc.gitee.github.pullrequest.action.GHPRReloadDetailsAction" use-shortcut-of="Refresh"/>
    </group>
    <action id="Github.PullRequest.Changes.Reload"
            class="cn.osc.gitee.github.pullrequest.action.GHPRReloadChangesAction" use-shortcut-of="Refresh"/>
    <action id="Github.PullRequest.Comments.Reload"
            class="cn.osc.gitee.github.pullrequest.action.GHPRReloadCommentsAction" use-shortcut-of="Refresh"/>

    <action id="Github.PullRequest.Review.Submit"
            class="cn.osc.gitee.github.pullrequest.action.GHPRReviewSubmitAction"/>

    <group id="Github.PullRequest.Changes.Toolbar">
      <reference id="Diff.ShowDiff"/>
      <reference id="Github.PullRequest.Review.Submit"/>
      <separator/>
      <reference id="ChangesView.GroupBy"/>
    </group>

    <group id="Github.PullRequest.Changes.Popup">
      <reference id="Diff.ShowDiff"/>
      <reference id="Diff.ShowStandaloneDiff"/>
      <reference id="Github.PullRequest.Changes.Reload"/>
      <action id="Github.PullRequest.Changes.MarkViewed"
              class="cn.osc.gitee.github.pullrequest.action.GHPRMarkFilesViewedAction"/>
      <action id="Github.PullRequest.Changes.MarkNotViewed"
              class="cn.osc.gitee.github.pullrequest.action.GHPRMarkFilesNotViewedAction"/>
    </group>

    <group id="Github.PullRequest.Timeline.Popup">
      <action id="Github.PullRequest.Timeline.Update"
              class="cn.osc.gitee.github.pullrequest.action.GHPRUpdateTimelineAction" use-shortcut-of="Refresh"/>
    </group>

    <action id="Github.Break.Api.Requests" internal="true"
            class="cn.osc.gitee.github.api.GHRequestExecutorBreaker$Action"/>

    <action id="Github.PullRequest.Diff.Comment.Create"
            class="cn.osc.gitee.github.pullrequest.comment.action.GHPRCreateDiffCommentAction">
      <keyboard-shortcut first-keystroke="control shift X" keymap="$default"/>
      <keyboard-shortcut first-keystroke="control shift X" keymap="Eclipse" remove="true"/>
      <keyboard-shortcut first-keystroke="control shift X" keymap="Eclipse (Mac OS X)" remove="true"/>
      <keyboard-shortcut first-keystroke="meta shift X" keymap="Eclipse (Mac OS X)" remove="true"/>
      <keyboard-shortcut first-keystroke="control shift X" keymap="Emacs" remove="true"/>
      <add-to-group group-id="Diff.EditorPopupMenu"/>
    </action>

    <action id="GithubCopyPathProvider" class="cn.osc.gitee.github.GithubCopyPathProvider" icon="AllIcons.Vcs.Vendors.Github">
      <add-to-group group-id="CopyFileReference"/>
    </action>

    <action id="Github.Copy.Link.To.GitHub" class="cn.osc.gitee.github.GithubCopyPathProvider" icon="AllIcons.Vcs.Vendors.Github">
      <add-to-group group-id="Copy.Paste.Special" relative-to-action="CopyReference" anchor="after"/>
    </action>
  </actions>
</idea-plugin>
